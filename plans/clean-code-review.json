{
  "generated_at": "2026-02-24",
  "scope": [
    "cmd/**/*.go",
    "internal/**/*.go"
  ],
  "issues": [
    {
      "id": "CC-001",
      "dimension": "functions",
      "title": "main function does too many things",
      "principle": "Small Functions + SRP",
      "location": "cmd/api/main.go:31-620",
      "severity": "High",
      "issue": "main is 590 lines and mixes startup configuration, dependency wiring, routes, background jobs, and server lifecycle.",
      "suggestion": "Extract focused bootstrap and registration functions."
    },
    {
      "id": "CC-002",
      "dimension": "functions",
      "title": "SyncConversations is oversized and multi-responsibility",
      "principle": "Small Functions + SRP",
      "location": "internal/service/intercom_sync.go:127-247",
      "severity": "High",
      "issue": "Method combines pagination, mapping, lookup, persistence, and event emission in a 121-line block.",
      "suggestion": "Split into dedicated helper functions and keep the outer orchestration thin."
    },
    {
      "id": "CC-003",
      "dimension": "duplication",
      "title": "Provider integration handlers duplicate control flow",
      "principle": "DRY",
      "location": "internal/handler/integration_stripe.go:27-117; internal/handler/integration_hubspot.go:27-115; internal/handler/integration_intercom.go:27-115",
      "severity": "High",
      "issue": "Connect/Callback/Status/Disconnect/TriggerSync patterns are nearly identical across providers.",
      "suggestion": "Create shared handler helpers or a provider strategy abstraction."
    },
    {
      "id": "CC-004",
      "dimension": "duplication",
      "title": "Full and incremental sync logic is repeated",
      "principle": "DRY",
      "location": "internal/service/stripe_sync.go:56-428; internal/service/intercom_sync.go:44-411; internal/service/hubspot_sync.go:48-507",
      "severity": "Medium",
      "issue": "Multiple full/incremental methods duplicate mapping and upsert pipelines.",
      "suggestion": "Refactor shared processing paths and keep source-fetch differences isolated."
    },
    {
      "id": "CC-005",
      "dimension": "functions",
      "title": "NewAlertScheduler has high parameter count",
      "principle": "Small Functions + SRP",
      "location": "internal/service/alert_scheduler.go:29-38",
      "severity": "Medium",
      "issue": "Constructor takes 9 parameters, indicating tight coupling.",
      "suggestion": "Use a dependency struct or grouped dependency bundles."
    },
    {
      "id": "CC-006",
      "dimension": "magic_numbers",
      "title": "Hardcoded limits and intervals repeated inline",
      "principle": "Avoid Hardcoding",
      "location": "cmd/api/main.go:85,383; internal/handler/integration_stripe.go:138,165; internal/handler/integration_hubspot.go:130; internal/handler/integration_intercom.go:130; internal/handler/billing.go:143",
      "severity": "Medium",
      "issue": "Values 300, 60, 65536, and 1024 are embedded directly and repeated.",
      "suggestion": "Promote to named constants and/or config-driven values."
    },
    {
      "id": "CC-007",
      "dimension": "yagni",
      "title": "Service error helper is indirectly coupled to AuthHandler",
      "principle": "YAGNI",
      "location": "internal/handler/integration_stripe.go:121-124",
      "severity": "Medium",
      "issue": "handleServiceError allocates AuthHandler only to forward error handling.",
      "suggestion": "Extract a standalone shared HTTP error translation utility."
    },
    {
      "id": "CC-008",
      "dimension": "structural_clarity",
      "title": "Route setup is deeply nested",
      "principle": "Readability First",
      "location": "cmd/api/main.go:90-578",
      "severity": "Medium",
      "issue": "Nested Route/Group closures and conditional blocks reduce readability and local reasoning.",
      "suggestion": "Split route registration into domain-specific functions."
    },
    {
      "id": "CC-009",
      "dimension": "conventions",
      "title": "String-based error matching",
      "principle": "Consistency",
      "location": "internal/repository/customer_event.go:47",
      "severity": "Low",
      "issue": "Compares error text (\"no rows in result set\") rather than typed error handling.",
      "suggestion": "Use typed checks (e.g., errors.Is with pgx no-rows sentinel)."
    },
    {
      "id": "CC-010",
      "dimension": "naming",
      "title": "Vague temporary buffer names in body reader",
      "principle": "Meaningful Names",
      "location": "internal/handler/integration_stripe.go:163-172",
      "severity": "Low",
      "issue": "Names like buf/tmp communicate structure but not intent.",
      "suggestion": "Use intent-revealing names like bodyBytes/chunkBuffer."
    }
  ],
  "summary": {
    "high": 3,
    "medium": 5,
    "low": 2,
    "total": 10
  }
}
